<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>RP Digital Bank - Edit Member</title>
<link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
<script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
<style>
.container {
	background-color: #fff;
	padding: 20px;
	border-radius: 10px;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
	margin-top: 20px;
}
</style>
</head>
<body>
	<div class="container">
        <div th:replace="fragments/header"></div>
        <main>
            <h1>Edit Member</h1>
            <form th:action="@{/Member/edit/{id}(id=${member.id})}" th:object="${member}" method="post" novalidate>
               <!--  <div class="mb-3 col-5">
                    <label for="customId" class="form-label">ID</label>
                    <input id="customId" class="form-control" type="text" th:field="*{customId}" readonly>
                </div> -->
                <div class="mb-3 col-5">
                    <label for="member_name" class="form-label">Name</label>
                    <input id="member_name" class="form-control" type="text" th:field="*{name}">
                </div>
                <div class="mb-3 col-5">
                    <label for="member_username" class="form-label">Username</label>
                    <input id="member_username" class="form-control" type="text" th:field="*{username}">
                </div>
                <div class="mb-3 col-5">
                    <label for="member_email" class="form-label">Email</label>
                    <input id="member_email" class="form-control" type="email" th:field="*{email}">
                </div>
                <div class="mb-3 col-5">
                    <label for="member_password" class="form-label">Password</label>
                    <input id="member_password" class="form-control" type="text" th:field="*{password}" readonly>
                </div>
                <div class="mb-3 col-5">
                    <label for="member_nric" class="form-label">NRIC</label>
                    <input id="member_nric" class="form-control" type="text" th:field="*{nric}" readonly>
                </div>
                <div class="mb-3 col-5">
                    <label for="member_role" class="form-label">Role</label>
                    <select id="member_role" class="form-control" th:field="*{role}">
                        <option value="ROLE_USER">User</option>
                        <option value="ROLE_BO">Back Office</option>
                        <option value="ROLE_FA">Financial Advisor</option>
                    </select>
                </div>
                <div class="mb-3 col-5">
                    <label for="accountNonLocked" class="form-label">Account Status</label>
                    <select id="accountNonLocked" class="form-control" th:field="*{accountNonLocked}">
                        <option value="true">Unlocked</option>
                        <option value="false">Locked</option>
                    </select>
                </div>
                <div th:if="*{accountNonLocked == false}" class="locked-fields">
                    <div class="mb-3 col-5">
                        <label for="failedAttempt" class="form-label">Failed Attempts</label>
                        <input id="failedAttempt" class="form-control" type="number" th:field="*{failedAttempt}">
                    </div>
                    <div class="mb-3 col-5">
                        <label for="lockTime" class="form-label">Lock Time</label>
                        <input id="lockTime" class="form-control" type="datetime-local" th:field="*{lockTime}">
                    </div>
                </div>
                <div class="mt-3 mb-5">
                    <input type="submit" value="Update Member" class="btn btn-primary">
                </div>
            </form>
        </main>
        <div th:replace="fragments/footer"></div>
    </div>
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			// Make NRIC non-editable
			const nricField = document.getElementById("member_nric");
			const originalNric = nricField.value;
			nricField.value = 'XXXXX' + originalNric.slice(-4);

			document.addEventListener("DOMContentLoaded", function() {
			    const roleField = document.getElementById("member_role");
			    const customIdField = document.getElementById("customId");

			    // Function to update customId based on role
			    function updateCustomId() {
			        const currentId = customIdField.value; // e.g., BO00001, UR00001
			        if (currentId.length <= 2) {
			            console.error("Invalid customId format:", currentId);
			            return;
			        }

			        // Extract the numeric part of the ID
			        const numericPart = currentId.slice(2); // e.g., 00001
			        let prefix;

			        // Determine prefix based on role
			        switch (roleField.value) {
			            case "ROLE_BO":
			                prefix = "BO";
			                break;
			            case "ROLE_FA":
			                prefix = "FA";
			                break;
			            case "ROLE_USER":
			                prefix = "UR";
			                break;
			            default:
			                console.error("Unknown role value:", roleField.value);
			                return;
			        }

			        // Update the customId field
			        customIdField.value = prefix + numericPart;
			        console.log("Custom ID updated to:", customIdField.value);
			    }

			    // Add event listener to detect role changes
			    roleField.addEventListener("change", updateCustomId);
			});


			
			// Toggle locked fields
			const accountNonLockedField = document.getElementById("accountNonLocked");
			const lockedFields = document.querySelector(".locked-fields");
			function toggleLockedFields() {
				lockedFields.style.display = accountNonLockedField.value === "false" ? "block" : "none";
			}
			toggleLockedFields();
			accountNonLockedField.addEventListener("change", toggleLockedFields);
		});
	</script>
</body>
</html>